/* Generated by Together */

package com.iss.itreasury.codingrule.bizlogic;
import com.iss.itreasury.codingrule.dataentity.CodingRuleInfo;
import com.iss.itreasury.codingrule.dataentity.SerialnumberDetailInfo;
import com.iss.itreasury.codingrule.dataentity.SerialnumberInfo;
import java.util.Collection;

import com.iss.itreasury.codingrule.dao.Sys_CodingRuleDao;
import com.iss.itreasury.codingrule.dao.Sys_SerialNumberDao;
import com.iss.itreasury.codingrule.dao.Sys_SerialNumberDetailDao;
import com.iss.itreasury.dao.ITreasuryDAOException;
import com.iss.itreasury.system.setting.dao.DepartmentDAO;
import com.iss.itreasury.system.util.SYSConstant;
import com.iss.itreasury.util.SessionMng;

/* Author:YanLiu */

public class SerialNumberBiz
{    
    public long addSerialNumber(SerialnumberInfo info,SessionMng sessionMng) 
    {
    	long id =-1;
    	Sys_SerialNumberDao dao = new Sys_SerialNumberDao();
    	Sys_SerialNumberDetailDao detailDao = new Sys_SerialNumberDetailDao();
        SerialnumberDetailInfo detailInfo = new SerialnumberDetailInfo();
        if(info.getId()<0)
        {
        	try {
        		dao.setUseMaxID();
				id=dao.add(info);
			} catch (ITreasuryDAOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
			try{
				detailDao.setUseMaxID();
				if(info.getIscurrency()==1)
				{
					detailInfo.setCurrencyid(sessionMng.m_lCurrencyID);
				}
				detailInfo.setSerialno(1);  //新增流水号初始化值为1
				detailInfo.setSerialnumberid(id);
				detailDao.add(detailInfo);
			} catch (ITreasuryDAOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
        }
       
        return id;
    }

    public long deleteSerialNumber(long[] lDeleteID) 
    {
    	long id=-1;
    	Sys_SerialNumberDao dao = new Sys_SerialNumberDao();
    	Sys_SerialNumberDetailDao serialNumberDetailDao = new Sys_SerialNumberDetailDao();
    	DepartmentDAO departmentDao = new DepartmentDAO();
		long num = -1;
        try {
	        	for(int i=0;i<lDeleteID.length;i++)
	        	{
	        		SerialnumberInfo serialnumberinfo =new SerialnumberInfo();
	        		serialnumberinfo.setId(lDeleteID[i]);
	        		serialnumberinfo.setStatusid(SYSConstant.CodingRuleStatus.DELETED);
	        		num = departmentDao.querySerialNumberDel(serialnumberinfo.getId());
	        		if(num == 0){
	        			dao.update(serialnumberinfo);
	        		}else{
	        			id = i;
	        			break;
	        		}
	        	}
			} catch (ITreasuryDAOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return id;
    }


    public SerialnumberInfo findByID(long id) 
    {
    	Sys_SerialNumberDao dao = new Sys_SerialNumberDao();
        	
    	SerialnumberInfo serialnumberinfo = null;
			try {
				serialnumberinfo = (SerialnumberInfo)dao.findByID(id,SerialnumberInfo.class);
			} catch (ITreasuryDAOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
        	return serialnumberinfo;
    }

    public Collection queryByCondtion(SerialnumberInfo info) 
    {
    	    Collection coll = null;
    	    Sys_SerialNumberDao dao = new Sys_SerialNumberDao();
        	try {
        		coll=dao.findByCondition(info);
			} catch (ITreasuryDAOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
            return coll;
    }


}
