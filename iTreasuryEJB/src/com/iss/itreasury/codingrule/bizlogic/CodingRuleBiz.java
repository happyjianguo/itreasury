/* Generated by Together */

package com.iss.itreasury.codingrule.bizlogic;
import com.iss.itreasury.codingrule.dataentity.CodingRuleInfo;

import java.util.ArrayList;
import java.util.Collection;
import com.iss.itreasury.codingrule.dao.Sys_CodingRuleDao;
import com.iss.itreasury.codingrule.dao.Sys_CodingRuleDetailDao;
import com.iss.itreasury.dao.ITreasuryDAOException;
import com.iss.itreasury.system.setting.dao.DepartmentDAO;
import com.iss.itreasury.system.util.SYSConstant;
import com.iss.itreasury.util.IException;

import java.util.Iterator;

/* Author:YanLiu */

public class CodingRuleBiz
{    
    public long addCodingRule(CodingRuleInfo info) 
    {
    	long id =-1;
		Sys_CodingRuleDao dao = new Sys_CodingRuleDao();
        Sys_CodingRuleDetailDao detailDao = new Sys_CodingRuleDetailDao();
        if(info.getId()<0)
        {
        	try {
        		dao.setUseMaxID();
				id=dao.add(info);
			} catch (ITreasuryDAOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
            Iterator it = info.getCodingRuleDetail().iterator();
            while(it.hasNext())
            {
				CodingRuleInfo detailInfo = (CodingRuleInfo)it.next();
				detailInfo.setCodingruleid(id);
				try {
					detailDao.setUseMaxID();
					detailDao.add(detailInfo);
				} catch (ITreasuryDAOException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
            }
        }
        else if(info.getId()>0)
        {
        	try {
				dao.update(info);
				detailDao.deleteCodingRuleDetail(info.getId());
				 Iterator it = info.getCodingRuleDetail().iterator();
		            while(it.hasNext())
		            {
						CodingRuleInfo detailInfo = (CodingRuleInfo)it.next();
						detailInfo.setCodingruleid(info.getId());
						try {
							detailDao.setUseMaxID();
							detailDao.add(detailInfo);
						} catch (ITreasuryDAOException e) {
							// TODO Auto-generated catch block
							e.printStackTrace();
						}
		            }
			} catch (ITreasuryDAOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
        	id=9999;
        }
        return id;
    }

    public long deleteCodingRule(long[] lDeleteID) 
    {
    	long id=-1;
		Sys_CodingRuleDao dao = new Sys_CodingRuleDao();
		Sys_CodingRuleDetailDao detailDao = new Sys_CodingRuleDetailDao();
		DepartmentDAO departmentDao = new DepartmentDAO();
		long num = -1;
		
        try {
	        	for(int i=0;i<lDeleteID.length;i++)
	        	{
	        		CodingRuleInfo CodingRuleInfo =new CodingRuleInfo();
	        		CodingRuleInfo.setId(lDeleteID[i]);
	        		CodingRuleInfo.setStatusID(SYSConstant.CodingRuleStatus.DELETED);
	        		
	        		num = departmentDao.queryCodingRuleDel(CodingRuleInfo.getId());
	        		if(num == 0){
	        			dao.update(CodingRuleInfo);
		    			detailDao.deleteCodingRuleDetail(CodingRuleInfo.getId());
	        		}else{
	        			id = i;
	        			break;
	        		}
	        		
	        	}
	        	
			} catch (ITreasuryDAOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return id;
    }
    
   

    public CodingRuleInfo findByID(long id) 
    {
        	Sys_CodingRuleDao dao = new Sys_CodingRuleDao();
        	
        	CodingRuleInfo codingruleinfo = null;
			try {
				codingruleinfo = (CodingRuleInfo)dao.findByID(id,CodingRuleInfo.class);
				CodingRuleInfo codingruledetailinfo =new CodingRuleInfo();
				codingruledetailinfo.setCodingruleid(codingruleinfo.getId());
				codingruleinfo.setCodingRuleDetail(queryByCondtionDetail(codingruledetailinfo));
			} catch (ITreasuryDAOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
        	return codingruleinfo;
    }

    public Collection queryByCondtion(CodingRuleInfo info) 
    {
    	    Collection coll = null;
        	Sys_CodingRuleDao dao = new Sys_CodingRuleDao();
        	try {
        		coll=dao.findByCondition(info);
			} catch (ITreasuryDAOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
            return coll;
    }
    public Collection queryByCondtionDetail(CodingRuleInfo info) 
    {
    	    Collection coll = null;
    	    Sys_CodingRuleDetailDao detailDao = new Sys_CodingRuleDetailDao();
        	try {
        		coll=detailDao.findByCondition(info," order by serialno asc");
			} catch (ITreasuryDAOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
            return coll;
    }

}
